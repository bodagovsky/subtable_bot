name: Sync Config Vars to Heroku

# This workflow syncs GitHub Secrets to Heroku config vars
# Since Heroku is connected to GitHub and auto-deploys,
# we only need to sync config vars, not deploy

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  sync-config:
    runs-on: ubuntu-latest
    environment: production
    
    steps:
    - name: Install Heroku CLI
      run: |
        curl https://cli-assets.heroku.com/install.sh | sh
    
    - name: Set Heroku config vars from GitHub Secrets
      run: |
        heroku config:set \
          OPENAI_API_KEY="${{ secrets.OPENAI_API_KEY }}" \
          OPENAI_MODEL="${{ secrets.OPENAI_MODEL || 'gpt-4o-mini' }}" \
          WEBHOOK_URL="${{ secrets.WEBHOOK_URL }}" \
          WEBHOOK_PATH="${{ secrets.WEBHOOK_PATH || '/webhook' }}" \
          WEBHOOK_SECRET_TOKEN="${{ secrets.WEBHOOK_SECRET_TOKEN }}" \
          REDISCLOUD_URL="${{ secrets.REDISCLOUD_URL }}" \
          REDIS_PASSWORD="${{ secrets.REDIS_PASSWORD }}" \
          REDIS_PORT="${{ secrets.REDIS_PORT }}" \
          REDIS_USERNAME="${{ secrets.REDIS_USERNAME }}" \
          TELEGRAM_API_HASH="${{ secrets.TELEGRAM_API_HASH }}" \
          TELEGRAM_API_ID="${{ secrets.TELEGRAM_API_ID }}" \
          TELEGRAM_BOT_TOKEN="${{ secrets.TELEGRAM_BOT_TOKEN }}" \
          IQAIR_API_KEY="${{ secrets.IQAIR_API_KEY }}" \
          --app "${{ vars.HEROKU_APP_NAME }}"
      env:
        HEROKU_API_KEY: "${{ secrets.HEROKU_API_KEY }}"

