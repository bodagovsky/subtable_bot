name: Sync Config Vars to Heroku

# This workflow syncs GitHub Secrets to Heroku config vars
# Since Heroku is connected to GitHub and auto-deploys,
# we only need to sync config vars, not deploy

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  sync-config:
    runs-on: ubuntu-latest
    
    steps:
    - name: Install Heroku CLI
      run: |
        curl https://cli-assets.heroku.com/install.sh | sh
    
    - name: Set Heroku config vars from GitHub Secrets
      run: |
        heroku config:set \
          TELEGRAM_BOT_TOKEN=${{ env.secrets.TELEGRAM_BOT_TOKEN }} \
          OPENAI_API_KEY=${{ env.secrets.OPENAI_API_KEY }} \
          OPENAI_MODEL=${{ env.secrets.OPENAI_MODEL || 'gpt-4o-mini' }} \
          WEBHOOK_URL=${{ env.secrets.WEBHOOK_URL }} \
          WEBHOOK_PATH=${{ env.secrets.WEBHOOK_PATH || '/webhook' }} \
          WEBHOOK_SECRET_TOKEN=${{ env.secrets.WEBHOOK_SECRET_TOKEN }} \
          --app ${{ env.vars.HEROKU_APP_NAME }}
      env:
        HEROKU_API_KEY: ${{ env.secrets.HEROKU_API_KEY }}

